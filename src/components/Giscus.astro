
<div class="comments-section">
</div>
<script src="https://giscus.app/client.js"
    data-repo="YouRan4/YouRan4.github.io"
    data-repo-id="R_kgDOQT4ToQ"
    data-category="Announcements"
    data-category-id="DIC_kwDOQT4Toc4CzvK9"
    data-mapping="og:title"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="javascript: (localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light')) === 'dark' ? 'noborder_dark' : 'noborder_light'"
    data-lang="zh-CN"
    crossorigin="anonymous"
    async>
</script>
<script>
window.syncGiscusTheme = function(theme) {
    const GISCUS_THEME_MAP = {
        "light": "noborder_light",
        "dark": "noborder_dark"
    };
    const giscusTheme = GISCUS_THEME_MAP[theme];
    if (!giscusTheme) return; 
    const iframe = document.querySelector('iframe.giscus-frame') as HTMLIFrameElement || null;
    if (!iframe) {
        setTimeout(() => window.syncGiscusTheme(theme), 500);
        return;
    }
    iframe.contentWindow?.postMessage(
        {
            giscus: {
                setConfig: {
                    theme: giscusTheme
                }
            }
        },
        'https://giscus.app'
    );
};

// ----------------------------------------------------
// 初始同步：一旦 DOM 加载完成，立即强制同步主题。
// ----------------------------------------------------
document.addEventListener('DOMContentLoaded', () => {
    // 这里的 window 是存在的
    const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
    window.syncGiscusTheme(currentTheme as "light" | "dark");
});

// ----------------------------------------------------
// 路由切换同步：处理页面软切换
// ----------------------------------------------------
document.addEventListener('astro:after-swap', () => {
    const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
    window.syncGiscusTheme(currentTheme as "light" | "dark");
});
</script>
<style>
/* ... 样式 ... */
</style>